{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "a4b50388-5a23-4291-b5c4-5e460dbb53a0",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import pandas as pd\n",
    "from bs4 import BeautifulSoup \n",
    "from lxml import etree"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "id": "6cb244de",
   "metadata": {},
   "outputs": [],
   "source": [
    "corpus = \"/home/ec2-user/SageMaker/data/Final_V1/\"\n",
    "input_files = os.listdir(corpus)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "518c5b27",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "currently sampling 10000 documents.\n"
     ]
    }
   ],
   "source": [
    "sample_size = 10000\n",
    "\n",
    "try: \n",
    "    sample_input_files = input_files[0:sample_size]\n",
    "    \n",
    "except ValueError:\n",
    "    sample_input_files = input_files\n",
    "    \n",
    "print(\"currently sampling\", len(sample_input_files), \"documents.\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "id": "4b47a895",
   "metadata": {},
   "outputs": [],
   "source": [
    "output_file = 'output_files/Convert_To_Dataframe_test.csv'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "decf6097",
   "metadata": {},
   "outputs": [],
   "source": [
    "def strip_html_tags(text):\n",
    "    stripped = BeautifulSoup(text).get_text().replace('\\n', ' ').replace('\\\\', ' ').strip()\n",
    "    return stripped"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "ee672f80",
   "metadata": {},
   "outputs": [],
   "source": [
    "def getxmlcontent(corpus, file, strip_html=True):\n",
    "    try:\n",
    "        tree = etree.parse(corpus + file)\n",
    "        root = tree.getroot()\n",
    "        \n",
    "        if root.find('.//GOID') is not None: \n",
    "            goid = root.find('.//GOID').text\n",
    "        else:\n",
    "            goid = None\n",
    "            \n",
    "        if root.find('.//Title') is not None: \n",
    "            title = root.find('.//Title').text\n",
    "        else:\n",
    "            title = None \n",
    "            \n",
    "        if root.find('.//NumericDate') is not None: \n",
    "            date = root.find('.//NumericDate').text\n",
    "        else:\n",
    "            date = None \n",
    "            \n",
    "        if root.find('.//PublisherName') is not None: \n",
    "            publisher = root.find('.//PublisherName').text\n",
    "        else: \n",
    "            publisher = None\n",
    "            \n",
    "        if root.find('.//FullText') is not None: \n",
    "            text = root.find('.//FullText').text\n",
    "            \n",
    "        elif root.find('.//HiddenText') is not None: \n",
    "            text = root.find('.//HiddenText').text\n",
    "            \n",
    "        elif root.find('.//Text') is not None: \n",
    "            text = root.find('.//Text').text\n",
    "            \n",
    "        else: \n",
    "            text = None\n",
    "        \n",
    "        if text is not None and strip_html == True: \n",
    "            text = strip_html_tags(text)\n",
    "            \n",
    "    except Exception as e: \n",
    "        print(f\"Error while parsing {file}: {e}\")\n",
    "        \n",
    "    return goid, title, date, publisher, text"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "efe2d100",
   "metadata": {},
   "outputs": [],
   "source": [
    "goid_list = []\n",
    "title_list = []\n",
    "date_list = []\n",
    "text_list = []\n",
    "\n",
    "for file in sample_input_files:\n",
    "    \n",
    "    goid, title, date, publisher, text = getxmlcontent(corpus, file, strip_html=True)\n",
    "    \n",
    "    goid_list.append(goid)\n",
    "    title_list.append(title)\n",
    "    date_list.append(date)\n",
    "    text_list.append(text)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "ea2d5f27",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = pd.DataFrame({'GOID': goid_list, 'Title': title_list, 'Date': date_list, 'Text': text_list})"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "4e32c7f2",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Title</th>\n",
       "      <th>Date</th>\n",
       "      <th>Text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>216531207</td>\n",
       "      <td>Chicago Central Medians</td>\n",
       "      <td>2002-02-01</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2734713215</td>\n",
       "      <td>Star Polycation Mediated dsRNA Improves the Ef...</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2756738009</td>\n",
       "      <td>Adsorption Performance of a Multimodal Anion-E...</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9995</th>\n",
       "      <td>893908848</td>\n",
       "      <td>COLONY MANAGEMENT</td>\n",
       "      <td>2011-03-01</td>\n",
       "      <td>What is colony management? Some beekeepers wan...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9996</th>\n",
       "      <td>2525772846</td>\n",
       "      <td>Growth Energy calls on EPA and DOE to boost et...</td>\n",
       "      <td>2021-05-12</td>\n",
       "      <td>In Washington, on the fifth day after the cybe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9997</th>\n",
       "      <td>203706786</td>\n",
       "      <td>Selected notifiable disease reports, United St...</td>\n",
       "      <td>2000-05-12</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9998</th>\n",
       "      <td>2543872642</td>\n",
       "      <td>Journal of Forestry Quiz</td>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>Quiz  July 2020 This Journal of Forestry quiz ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10000 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID                                              Title  \\\n",
       "0     2847381007  Trade Group Threatens Suit Over EPA's Large In...   \n",
       "1      216531207                            Chicago Central Medians   \n",
       "2     2734713215  Star Polycation Mediated dsRNA Improves the Ef...   \n",
       "3     2756738009  Adsorption Performance of a Multimodal Anion-E...   \n",
       "4     2820596472                                Listening to Storms   \n",
       "...          ...                                                ...   \n",
       "9995   893908848                                  COLONY MANAGEMENT   \n",
       "9996  2525772846  Growth Energy calls on EPA and DOE to boost et...   \n",
       "9997   203706786  Selected notifiable disease reports, United St...   \n",
       "9998  2543872642                           Journal of Forestry Quiz   \n",
       "9999  2130417268  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "            Date                                               Text  \n",
       "0     2023-08-08  August 7, 2023 As EPA weighs options to toughe...  \n",
       "1     2002-02-01                                               None  \n",
       "2     2022-01-01                                               None  \n",
       "3     2022-01-01                                               None  \n",
       "4     2008-06-23  A half-mile below the ocean’s surface, where g...  \n",
       "...          ...                                                ...  \n",
       "9995  2011-03-01  What is colony management? Some beekeepers wan...  \n",
       "9996  2021-05-12  In Washington, on the fifth day after the cybe...  \n",
       "9997  2000-05-12                                               None  \n",
       "9998  2020-07-01  Quiz  July 2020 This Journal of Forestry quiz ...  \n",
       "9999  2018-11-07  Regulatory Documents Agency: \"Office of Electr...  \n",
       "\n",
       "[10000 rows x 4 columns]"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "dbe4ca5f",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(10000, 4)"
      ]
     },
     "execution_count": 11,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c5c691ca",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Title</th>\n",
       "      <th>Date</th>\n",
       "      <th>Text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>7701</th>\n",
       "      <td>223124189</td>\n",
       "      <td>Signals leading to apoptosis-dependent inhibit...</td>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2912</th>\n",
       "      <td>219301182</td>\n",
       "      <td>Curbing information piracy</td>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7966</th>\n",
       "      <td>197987079</td>\n",
       "      <td>Out maneuvered, gunned, and of view: Test ban ...</td>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>Majority Leader Trent Lott: He pushed for more...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9160</th>\n",
       "      <td>234955910</td>\n",
       "      <td>Passage rates and timing of bird migration in ...</td>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>ABSTRACT.-Rates and timing of bird passage in ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8471</th>\n",
       "      <td>215888730</td>\n",
       "      <td>Dishwashers: How to buy the right one for you</td>\n",
       "      <td>2000-01-01</td>\n",
       "      <td>A critical piece of equipment lies well out of...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>490</th>\n",
       "      <td>3138952643</td>\n",
       "      <td>USDA-FDA Seek Information About Food Date Labe...</td>\n",
       "      <td>2024-12-03</td>\n",
       "      <td>WASHINGTON, Dec. 3, 2024 – The U.S. Food and D...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9199</th>\n",
       "      <td>3139361056</td>\n",
       "      <td>D.C. Circuit's CEQ Ruling Hangs Over Rare High...</td>\n",
       "      <td>2024-12-04</td>\n",
       "      <td>December 3, 2024 The Supreme Court is slated t...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2831</th>\n",
       "      <td>3141421951</td>\n",
       "      <td>OpenAI’s new defense contract completes its mi...</td>\n",
       "      <td>2024-12-04</td>\n",
       "      <td>At the start of 2024, OpenAI’s rules for how a...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8680</th>\n",
       "      <td>3141231023</td>\n",
       "      <td>EPA seeks to limit use of pesticide chlorpyrif...</td>\n",
       "      <td>2024-12-05</td>\n",
       "      <td>Dive Brief:The Environmental Protection Agency...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>668</th>\n",
       "      <td>3143421536</td>\n",
       "      <td>Endangered and Threatened Wildlife and Plants;...</td>\n",
       "      <td>2024-12-12</td>\n",
       "      <td>Federal Register Extracts Fish and Wildlife Se...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10000 rows × 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID                                              Title  \\\n",
       "7701   223124189  Signals leading to apoptosis-dependent inhibit...   \n",
       "2912   219301182                         Curbing information piracy   \n",
       "7966   197987079  Out maneuvered, gunned, and of view: Test ban ...   \n",
       "9160   234955910  Passage rates and timing of bird migration in ...   \n",
       "8471   215888730      Dishwashers: How to buy the right one for you   \n",
       "...          ...                                                ...   \n",
       "490   3138952643  USDA-FDA Seek Information About Food Date Labe...   \n",
       "9199  3139361056  D.C. Circuit's CEQ Ruling Hangs Over Rare High...   \n",
       "2831  3141421951  OpenAI’s new defense contract completes its mi...   \n",
       "8680  3141231023  EPA seeks to limit use of pesticide chlorpyrif...   \n",
       "668   3143421536  Endangered and Threatened Wildlife and Plants;...   \n",
       "\n",
       "            Date                                               Text  \n",
       "7701  2000-01-01                                               None  \n",
       "2912  2000-01-01                                               None  \n",
       "7966  2000-01-01  Majority Leader Trent Lott: He pushed for more...  \n",
       "9160  2000-01-01  ABSTRACT.-Rates and timing of bird passage in ...  \n",
       "8471  2000-01-01  A critical piece of equipment lies well out of...  \n",
       "...          ...                                                ...  \n",
       "490   2024-12-03  WASHINGTON, Dec. 3, 2024 – The U.S. Food and D...  \n",
       "9199  2024-12-04  December 3, 2024 The Supreme Court is slated t...  \n",
       "2831  2024-12-04  At the start of 2024, OpenAI’s rules for how a...  \n",
       "8680  2024-12-05  Dive Brief:The Environmental Protection Agency...  \n",
       "668   2024-12-12  Federal Register Extracts Fish and Wildlife Se...  \n",
       "\n",
       "[10000 rows x 4 columns]"
      ]
     },
     "execution_count": 12,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.sort_values(by='Date')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "id": "bd958943",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Year\n",
      "2000    112\n",
      "2001    212\n",
      "2002    233\n",
      "2003    212\n",
      "2004    207\n",
      "2005    241\n",
      "2006    194\n",
      "2007    236\n",
      "2008    225\n",
      "2009    218\n",
      "2010    262\n",
      "2011    278\n",
      "2012    430\n",
      "2013    476\n",
      "2014    417\n",
      "2015    460\n",
      "2016    405\n",
      "2017    586\n",
      "2018    779\n",
      "2019    867\n",
      "2020    752\n",
      "2021    679\n",
      "2022    618\n",
      "2023    502\n",
      "2024    399\n",
      "Name: count, dtype: int64\n"
     ]
    }
   ],
   "source": [
    "df['Date'] = pd.to_datetime(df['Date'])\n",
    "df['Year'] = df['Date'].dt.year\n",
    "year_counts = df.groupby('Year').size()\n",
    "year_counts = df['Year'].value_counts().sort_index()\n",
    "print(year_counts)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 14,
   "id": "ad753141",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Title</th>\n",
       "      <th>Date</th>\n",
       "      <th>Text</th>\n",
       "      <th>Year</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "      <td>2023</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>216531207</td>\n",
       "      <td>Chicago Central Medians</td>\n",
       "      <td>2002-02-01</td>\n",
       "      <td>None</td>\n",
       "      <td>2002</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2734713215</td>\n",
       "      <td>Star Polycation Mediated dsRNA Improves the Ef...</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>None</td>\n",
       "      <td>2022</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2756738009</td>\n",
       "      <td>Adsorption Performance of a Multimodal Anion-E...</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>None</td>\n",
       "      <td>2022</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "      <td>2008</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9995</th>\n",
       "      <td>893908848</td>\n",
       "      <td>COLONY MANAGEMENT</td>\n",
       "      <td>2011-03-01</td>\n",
       "      <td>What is colony management? Some beekeepers wan...</td>\n",
       "      <td>2011</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9996</th>\n",
       "      <td>2525772846</td>\n",
       "      <td>Growth Energy calls on EPA and DOE to boost et...</td>\n",
       "      <td>2021-05-12</td>\n",
       "      <td>In Washington, on the fifth day after the cybe...</td>\n",
       "      <td>2021</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9997</th>\n",
       "      <td>203706786</td>\n",
       "      <td>Selected notifiable disease reports, United St...</td>\n",
       "      <td>2000-05-12</td>\n",
       "      <td>None</td>\n",
       "      <td>2000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9998</th>\n",
       "      <td>2543872642</td>\n",
       "      <td>Journal of Forestry Quiz</td>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>Quiz  July 2020 This Journal of Forestry quiz ...</td>\n",
       "      <td>2020</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "      <td>2018</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10000 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID                                              Title  \\\n",
       "0     2847381007  Trade Group Threatens Suit Over EPA's Large In...   \n",
       "1      216531207                            Chicago Central Medians   \n",
       "2     2734713215  Star Polycation Mediated dsRNA Improves the Ef...   \n",
       "3     2756738009  Adsorption Performance of a Multimodal Anion-E...   \n",
       "4     2820596472                                Listening to Storms   \n",
       "...          ...                                                ...   \n",
       "9995   893908848                                  COLONY MANAGEMENT   \n",
       "9996  2525772846  Growth Energy calls on EPA and DOE to boost et...   \n",
       "9997   203706786  Selected notifiable disease reports, United St...   \n",
       "9998  2543872642                           Journal of Forestry Quiz   \n",
       "9999  2130417268  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "           Date                                               Text  Year  \n",
       "0    2023-08-08  August 7, 2023 As EPA weighs options to toughe...  2023  \n",
       "1    2002-02-01                                               None  2002  \n",
       "2    2022-01-01                                               None  2022  \n",
       "3    2022-01-01                                               None  2022  \n",
       "4    2008-06-23  A half-mile below the ocean’s surface, where g...  2008  \n",
       "...         ...                                                ...   ...  \n",
       "9995 2011-03-01  What is colony management? Some beekeepers wan...  2011  \n",
       "9996 2021-05-12  In Washington, on the fifth day after the cybe...  2021  \n",
       "9997 2000-05-12                                               None  2000  \n",
       "9998 2020-07-01  Quiz  July 2020 This Journal of Forestry quiz ...  2020  \n",
       "9999 2018-11-07  Regulatory Documents Agency: \"Office of Electr...  2018  \n",
       "\n",
       "[10000 rows x 5 columns]"
      ]
     },
     "execution_count": 14,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "id": "097e435e",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Date</th>\n",
       "      <th>Year</th>\n",
       "      <th>Title</th>\n",
       "      <th>Text</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>2023</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>216531207</td>\n",
       "      <td>2002-02-01</td>\n",
       "      <td>2002</td>\n",
       "      <td>Chicago Central Medians</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>2734713215</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>2022</td>\n",
       "      <td>Star Polycation Mediated dsRNA Improves the Ef...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>2756738009</td>\n",
       "      <td>2022-01-01</td>\n",
       "      <td>2022</td>\n",
       "      <td>Adsorption Performance of a Multimodal Anion-E...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>2008</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9995</th>\n",
       "      <td>893908848</td>\n",
       "      <td>2011-03-01</td>\n",
       "      <td>2011</td>\n",
       "      <td>COLONY MANAGEMENT</td>\n",
       "      <td>What is colony management? Some beekeepers wan...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9996</th>\n",
       "      <td>2525772846</td>\n",
       "      <td>2021-05-12</td>\n",
       "      <td>2021</td>\n",
       "      <td>Growth Energy calls on EPA and DOE to boost et...</td>\n",
       "      <td>In Washington, on the fifth day after the cybe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9997</th>\n",
       "      <td>203706786</td>\n",
       "      <td>2000-05-12</td>\n",
       "      <td>2000</td>\n",
       "      <td>Selected notifiable disease reports, United St...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9998</th>\n",
       "      <td>2543872642</td>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>2020</td>\n",
       "      <td>Journal of Forestry Quiz</td>\n",
       "      <td>Quiz  July 2020 This Journal of Forestry quiz ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>2018</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10000 rows × 5 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID       Date  Year  \\\n",
       "0     2847381007 2023-08-08  2023   \n",
       "1      216531207 2002-02-01  2002   \n",
       "2     2734713215 2022-01-01  2022   \n",
       "3     2756738009 2022-01-01  2022   \n",
       "4     2820596472 2008-06-23  2008   \n",
       "...          ...        ...   ...   \n",
       "9995   893908848 2011-03-01  2011   \n",
       "9996  2525772846 2021-05-12  2021   \n",
       "9997   203706786 2000-05-12  2000   \n",
       "9998  2543872642 2020-07-01  2020   \n",
       "9999  2130417268 2018-11-07  2018   \n",
       "\n",
       "                                                  Title  \\\n",
       "0     Trade Group Threatens Suit Over EPA's Large In...   \n",
       "1                               Chicago Central Medians   \n",
       "2     Star Polycation Mediated dsRNA Improves the Ef...   \n",
       "3     Adsorption Performance of a Multimodal Anion-E...   \n",
       "4                                   Listening to Storms   \n",
       "...                                                 ...   \n",
       "9995                                  COLONY MANAGEMENT   \n",
       "9996  Growth Energy calls on EPA and DOE to boost et...   \n",
       "9997  Selected notifiable disease reports, United St...   \n",
       "9998                           Journal of Forestry Quiz   \n",
       "9999  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "                                                   Text  \n",
       "0     August 7, 2023 As EPA weighs options to toughe...  \n",
       "1                                                  None  \n",
       "2                                                  None  \n",
       "3                                                  None  \n",
       "4     A half-mile below the ocean’s surface, where g...  \n",
       "...                                                 ...  \n",
       "9995  What is colony management? Some beekeepers wan...  \n",
       "9996  In Washington, on the fifth day after the cybe...  \n",
       "9997                                               None  \n",
       "9998  Quiz  July 2020 This Journal of Forestry quiz ...  \n",
       "9999  Regulatory Documents Agency: \"Office of Electr...  \n",
       "\n",
       "[10000 rows x 5 columns]"
      ]
     },
     "execution_count": 15,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "new_order = ['GOID', 'Date', 'Year', 'Title', 'Text']\n",
    "df = df[new_order]\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 16,
   "id": "5ba9c5fa",
   "metadata": {},
   "outputs": [],
   "source": [
    "import nltk\n",
    "# Use this line to point at nltk_data folder\n",
    "nltk.data.path.append(\"/home/ec2-user/SageMaker/nltk_data/\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "id": "01e821f7",
   "metadata": {},
   "outputs": [],
   "source": [
    "from nltk.corpus import stopwords\n",
    "from nltk.stem import WordNetLemmatizer\n",
    "from nltk.corpus import wordnet\n",
    "from nltk import pos_tag\n",
    "\n",
    "lemmatizer = WordNetLemmatizer()\n",
    "\n",
    "def get_wordnet_pos(word):\n",
    "    tag = pos_tag([word])[0][1][0].upper()\n",
    "    tag_dict = {\n",
    "        'J':wordnet.ADJ,\n",
    "        'N':wordnet.NOUN,\n",
    "        'V':wordnet.VERB,\n",
    "        'R':wordnet.ADV\n",
    "    }\n",
    "    return tag_dict.get(tag, wordnet.NOUN)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "id": "3dc37240",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_19877/1688472727.py:24: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df.loc[:, 'Processed_Tokens'] = df['Text'].apply(preprocess_text)\n"
     ]
    }
   ],
   "source": [
    "import re\n",
    "def preprocess_text(text):\n",
    "    if not isinstance(text, str):\n",
    "        return []\n",
    "\n",
    "    # Lowercase and remove punctuation\n",
    "    text = text.lower()\n",
    "    text = re.sub(r'[^a-z\\s]', ' ', text)\n",
    "\n",
    "    # Tokenize\n",
    "    tokens = text.split()\n",
    "    tokens = [word for word in text.split() if len(word) > 1]\n",
    "\n",
    "    # Lemmatize tokens\n",
    "    lemmatized_tokens = [lemmatizer.lemmatize(word, get_wordnet_pos(word)) for word in tokens]\n",
    "\n",
    "    # Remove stopwords (after lemmatization)\n",
    "    custom_stopwords = set(stopwords.words('english') + ['get', 'include', 'may', 'make', 'would', 'one', 'new', 'see', 'go', 'co', 'pubmed', 'pdf', 'u', 'use', 'www', 'say', 'year', 'et', 'al', 'c', 'pmid', 'doi', 'http', 'also', 'de', 'dx', 'org', 'pp', 'ncbi', 'ce', 'cc'])\n",
    "    tokens_clean = [word for word in lemmatized_tokens if word not in custom_stopwords]\n",
    "\n",
    "    return tokens_clean\n",
    "\n",
    "# Apply preprocessing\n",
    "df.loc[:, 'Processed_Tokens'] = df['Text'].apply(preprocess_text)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 19,
   "id": "052db0cd",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_19877/955798070.py:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df.dropna(inplace=True)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Date</th>\n",
       "      <th>Year</th>\n",
       "      <th>Title</th>\n",
       "      <th>Text</th>\n",
       "      <th>Processed_Tokens</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>2023</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "      <td>[august, epa, weighs, option, toughen, air, to...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>2008</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "      <td>[half, mile, ocean, surface, giant, squid, spe...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2431017460</td>\n",
       "      <td>2020-08-06</td>\n",
       "      <td>2020</td>\n",
       "      <td>Inside Clean Energy: What’s a Virtual Power Pl...</td>\n",
       "      <td>Remember Megazord, the giant robot hero from c...</td>\n",
       "      <td>[remember, megazord, giant, robot, hero, child...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>224899780</td>\n",
       "      <td>2008-08-01</td>\n",
       "      <td>2008</td>\n",
       "      <td>URBAN DRILLING</td>\n",
       "      <td>Drilling for gas right next to a major univers...</td>\n",
       "      <td>[drilling, gas, right, next, major, university...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>1418214327</td>\n",
       "      <td>2013-08-07</td>\n",
       "      <td>2013</td>\n",
       "      <td>Farmersonly.com Is Connecting Cowboys To Cowgirls</td>\n",
       "      <td>Warning: this blog post is a departure from my...</td>\n",
       "      <td>[warn, blog, post, departure, typical, post, c...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9994</th>\n",
       "      <td>1514472595</td>\n",
       "      <td>2014-03-01</td>\n",
       "      <td>2014</td>\n",
       "      <td>NFPA 32 HOLD THE STARCH</td>\n",
       "      <td>As NFPA's dry cleaning standard approaches its...</td>\n",
       "      <td>[nfpa, dry, cleaning, standard, approach, th, ...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9995</th>\n",
       "      <td>893908848</td>\n",
       "      <td>2011-03-01</td>\n",
       "      <td>2011</td>\n",
       "      <td>COLONY MANAGEMENT</td>\n",
       "      <td>What is colony management? Some beekeepers wan...</td>\n",
       "      <td>[colony, management, beekeeper, want, manageme...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9996</th>\n",
       "      <td>2525772846</td>\n",
       "      <td>2021-05-12</td>\n",
       "      <td>2021</td>\n",
       "      <td>Growth Energy calls on EPA and DOE to boost et...</td>\n",
       "      <td>In Washington, on the fifth day after the cybe...</td>\n",
       "      <td>[washington, fifth, day, cyberattack, colonial...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9998</th>\n",
       "      <td>2543872642</td>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>2020</td>\n",
       "      <td>Journal of Forestry Quiz</td>\n",
       "      <td>Quiz  July 2020 This Journal of Forestry quiz ...</td>\n",
       "      <td>[quiz, july, journal, forestry, quiz, approve,...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>2018</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "      <td>[regulatory, document, agency, office, electri...</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>7837 rows × 6 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID       Date  Year  \\\n",
       "0     2847381007 2023-08-08  2023   \n",
       "4     2820596472 2008-06-23  2008   \n",
       "5     2431017460 2020-08-06  2020   \n",
       "7      224899780 2008-08-01  2008   \n",
       "8     1418214327 2013-08-07  2013   \n",
       "...          ...        ...   ...   \n",
       "9994  1514472595 2014-03-01  2014   \n",
       "9995   893908848 2011-03-01  2011   \n",
       "9996  2525772846 2021-05-12  2021   \n",
       "9998  2543872642 2020-07-01  2020   \n",
       "9999  2130417268 2018-11-07  2018   \n",
       "\n",
       "                                                  Title  \\\n",
       "0     Trade Group Threatens Suit Over EPA's Large In...   \n",
       "4                                   Listening to Storms   \n",
       "5     Inside Clean Energy: What’s a Virtual Power Pl...   \n",
       "7                                        URBAN DRILLING   \n",
       "8     Farmersonly.com Is Connecting Cowboys To Cowgirls   \n",
       "...                                                 ...   \n",
       "9994                            NFPA 32 HOLD THE STARCH   \n",
       "9995                                  COLONY MANAGEMENT   \n",
       "9996  Growth Energy calls on EPA and DOE to boost et...   \n",
       "9998                           Journal of Forestry Quiz   \n",
       "9999  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "                                                   Text  \\\n",
       "0     August 7, 2023 As EPA weighs options to toughe...   \n",
       "4     A half-mile below the ocean’s surface, where g...   \n",
       "5     Remember Megazord, the giant robot hero from c...   \n",
       "7     Drilling for gas right next to a major univers...   \n",
       "8     Warning: this blog post is a departure from my...   \n",
       "...                                                 ...   \n",
       "9994  As NFPA's dry cleaning standard approaches its...   \n",
       "9995  What is colony management? Some beekeepers wan...   \n",
       "9996  In Washington, on the fifth day after the cybe...   \n",
       "9998  Quiz  July 2020 This Journal of Forestry quiz ...   \n",
       "9999  Regulatory Documents Agency: \"Office of Electr...   \n",
       "\n",
       "                                       Processed_Tokens  \n",
       "0     [august, epa, weighs, option, toughen, air, to...  \n",
       "4     [half, mile, ocean, surface, giant, squid, spe...  \n",
       "5     [remember, megazord, giant, robot, hero, child...  \n",
       "7     [drilling, gas, right, next, major, university...  \n",
       "8     [warn, blog, post, departure, typical, post, c...  \n",
       "...                                                 ...  \n",
       "9994  [nfpa, dry, cleaning, standard, approach, th, ...  \n",
       "9995  [colony, management, beekeeper, want, manageme...  \n",
       "9996  [washington, fifth, day, cyberattack, colonial...  \n",
       "9998  [quiz, july, journal, forestry, quiz, approve,...  \n",
       "9999  [regulatory, document, agency, office, electri...  \n",
       "\n",
       "[7837 rows x 6 columns]"
      ]
     },
     "execution_count": 19,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.dropna(inplace=True)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 20,
   "id": "7345be7e",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_19877/1219245229.py:9: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame.\n",
      "Try using .loc[row_indexer,col_indexer] = value instead\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df['Time_Period'] = None\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Date</th>\n",
       "      <th>Year</th>\n",
       "      <th>Title</th>\n",
       "      <th>Text</th>\n",
       "      <th>Processed_Tokens</th>\n",
       "      <th>Time_Period</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>2023</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "      <td>[august, epa, weighs, option, toughen, air, to...</td>\n",
       "      <td>5. Inflation Reduction Act</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>2008</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "      <td>[half, mile, ocean, surface, giant, squid, spe...</td>\n",
       "      <td>2. Energy Policy Act of 2005 &amp; Energy Security...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>2431017460</td>\n",
       "      <td>2020-08-06</td>\n",
       "      <td>2020</td>\n",
       "      <td>Inside Clean Energy: What’s a Virtual Power Pl...</td>\n",
       "      <td>Remember Megazord, the giant robot hero from c...</td>\n",
       "      <td>[remember, megazord, giant, robot, hero, child...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>224899780</td>\n",
       "      <td>2008-08-01</td>\n",
       "      <td>2008</td>\n",
       "      <td>URBAN DRILLING</td>\n",
       "      <td>Drilling for gas right next to a major univers...</td>\n",
       "      <td>[drilling, gas, right, next, major, university...</td>\n",
       "      <td>2. Energy Policy Act of 2005 &amp; Energy Security...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>1418214327</td>\n",
       "      <td>2013-08-07</td>\n",
       "      <td>2013</td>\n",
       "      <td>Farmersonly.com Is Connecting Cowboys To Cowgirls</td>\n",
       "      <td>Warning: this blog post is a departure from my...</td>\n",
       "      <td>[warn, blog, post, departure, typical, post, c...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9994</th>\n",
       "      <td>1514472595</td>\n",
       "      <td>2014-03-01</td>\n",
       "      <td>2014</td>\n",
       "      <td>NFPA 32 HOLD THE STARCH</td>\n",
       "      <td>As NFPA's dry cleaning standard approaches its...</td>\n",
       "      <td>[nfpa, dry, cleaning, standard, approach, th, ...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9995</th>\n",
       "      <td>893908848</td>\n",
       "      <td>2011-03-01</td>\n",
       "      <td>2011</td>\n",
       "      <td>COLONY MANAGEMENT</td>\n",
       "      <td>What is colony management? Some beekeepers wan...</td>\n",
       "      <td>[colony, management, beekeeper, want, manageme...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9996</th>\n",
       "      <td>2525772846</td>\n",
       "      <td>2021-05-12</td>\n",
       "      <td>2021</td>\n",
       "      <td>Growth Energy calls on EPA and DOE to boost et...</td>\n",
       "      <td>In Washington, on the fifth day after the cybe...</td>\n",
       "      <td>[washington, fifth, day, cyberattack, colonial...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9998</th>\n",
       "      <td>2543872642</td>\n",
       "      <td>2020-07-01</td>\n",
       "      <td>2020</td>\n",
       "      <td>Journal of Forestry Quiz</td>\n",
       "      <td>Quiz  July 2020 This Journal of Forestry quiz ...</td>\n",
       "      <td>[quiz, july, journal, forestry, quiz, approve,...</td>\n",
       "      <td>None</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>2018</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "      <td>[regulatory, document, agency, office, electri...</td>\n",
       "      <td>4. Withdrawal from Paris Agreement</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>7837 rows × 7 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID       Date  Year  \\\n",
       "0     2847381007 2023-08-08  2023   \n",
       "4     2820596472 2008-06-23  2008   \n",
       "5     2431017460 2020-08-06  2020   \n",
       "7      224899780 2008-08-01  2008   \n",
       "8     1418214327 2013-08-07  2013   \n",
       "...          ...        ...   ...   \n",
       "9994  1514472595 2014-03-01  2014   \n",
       "9995   893908848 2011-03-01  2011   \n",
       "9996  2525772846 2021-05-12  2021   \n",
       "9998  2543872642 2020-07-01  2020   \n",
       "9999  2130417268 2018-11-07  2018   \n",
       "\n",
       "                                                  Title  \\\n",
       "0     Trade Group Threatens Suit Over EPA's Large In...   \n",
       "4                                   Listening to Storms   \n",
       "5     Inside Clean Energy: What’s a Virtual Power Pl...   \n",
       "7                                        URBAN DRILLING   \n",
       "8     Farmersonly.com Is Connecting Cowboys To Cowgirls   \n",
       "...                                                 ...   \n",
       "9994                            NFPA 32 HOLD THE STARCH   \n",
       "9995                                  COLONY MANAGEMENT   \n",
       "9996  Growth Energy calls on EPA and DOE to boost et...   \n",
       "9998                           Journal of Forestry Quiz   \n",
       "9999  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "                                                   Text  \\\n",
       "0     August 7, 2023 As EPA weighs options to toughe...   \n",
       "4     A half-mile below the ocean’s surface, where g...   \n",
       "5     Remember Megazord, the giant robot hero from c...   \n",
       "7     Drilling for gas right next to a major univers...   \n",
       "8     Warning: this blog post is a departure from my...   \n",
       "...                                                 ...   \n",
       "9994  As NFPA's dry cleaning standard approaches its...   \n",
       "9995  What is colony management? Some beekeepers wan...   \n",
       "9996  In Washington, on the fifth day after the cybe...   \n",
       "9998  Quiz  July 2020 This Journal of Forestry quiz ...   \n",
       "9999  Regulatory Documents Agency: \"Office of Electr...   \n",
       "\n",
       "                                       Processed_Tokens  \\\n",
       "0     [august, epa, weighs, option, toughen, air, to...   \n",
       "4     [half, mile, ocean, surface, giant, squid, spe...   \n",
       "5     [remember, megazord, giant, robot, hero, child...   \n",
       "7     [drilling, gas, right, next, major, university...   \n",
       "8     [warn, blog, post, departure, typical, post, c...   \n",
       "...                                                 ...   \n",
       "9994  [nfpa, dry, cleaning, standard, approach, th, ...   \n",
       "9995  [colony, management, beekeeper, want, manageme...   \n",
       "9996  [washington, fifth, day, cyberattack, colonial...   \n",
       "9998  [quiz, july, journal, forestry, quiz, approve,...   \n",
       "9999  [regulatory, document, agency, office, electri...   \n",
       "\n",
       "                                            Time_Period  \n",
       "0                            5. Inflation Reduction Act  \n",
       "4     2. Energy Policy Act of 2005 & Energy Security...  \n",
       "5                                                  None  \n",
       "7     2. Energy Policy Act of 2005 & Energy Security...  \n",
       "8                                                  None  \n",
       "...                                                 ...  \n",
       "9994                                               None  \n",
       "9995                                               None  \n",
       "9996                                               None  \n",
       "9998                                               None  \n",
       "9999                 4. Withdrawal from Paris Agreement  \n",
       "\n",
       "[7837 rows x 7 columns]"
      ]
     },
     "execution_count": 20,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "Time_Period = [\n",
    "    (2000, 2004, \"1. Before Federal Energy Policy\"),\n",
    "    (2005, 2008, \"2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007\"),\n",
    "    (2009, 2010, \"3. American Recovery and Reinvestment Act of 2009\"),\n",
    "    (2017, 2018, \"4. Withdrawal from Paris Agreement\"),\n",
    "    (2022, 2023, \"5. Inflation Reduction Act\")\n",
    "]\n",
    "\n",
    "df['Time_Period'] = None\n",
    "\n",
    "for start, end, label in Time_Period:\n",
    "    df.loc[(df['Year'] >= start) & (df['Year'] <= end), 'Time_Period'] = label\n",
    "    \n",
    "df\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 21,
   "id": "52603af1",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_19877/955798070.py:1: SettingWithCopyWarning: \n",
      "A value is trying to be set on a copy of a slice from a DataFrame\n",
      "\n",
      "See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy\n",
      "  df.dropna(inplace=True)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>GOID</th>\n",
       "      <th>Date</th>\n",
       "      <th>Year</th>\n",
       "      <th>Title</th>\n",
       "      <th>Text</th>\n",
       "      <th>Processed_Tokens</th>\n",
       "      <th>Time_Period</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>2847381007</td>\n",
       "      <td>2023-08-08</td>\n",
       "      <td>2023</td>\n",
       "      <td>Trade Group Threatens Suit Over EPA's Large In...</td>\n",
       "      <td>August 7, 2023 As EPA weighs options to toughe...</td>\n",
       "      <td>[august, epa, weighs, option, toughen, air, to...</td>\n",
       "      <td>5. Inflation Reduction Act</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>2820596472</td>\n",
       "      <td>2008-06-23</td>\n",
       "      <td>2008</td>\n",
       "      <td>Listening to Storms</td>\n",
       "      <td>A half-mile below the ocean’s surface, where g...</td>\n",
       "      <td>[half, mile, ocean, surface, giant, squid, spe...</td>\n",
       "      <td>2. Energy Policy Act of 2005 &amp; Energy Security...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>224899780</td>\n",
       "      <td>2008-08-01</td>\n",
       "      <td>2008</td>\n",
       "      <td>URBAN DRILLING</td>\n",
       "      <td>Drilling for gas right next to a major univers...</td>\n",
       "      <td>[drilling, gas, right, next, major, university...</td>\n",
       "      <td>2. Energy Policy Act of 2005 &amp; Energy Security...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>1963104817</td>\n",
       "      <td>2017-12-01</td>\n",
       "      <td>2017</td>\n",
       "      <td>Association of eating out with bone density in...</td>\n",
       "      <td>(ProQuest: ... denotes formulae and/or non-US-...</td>\n",
       "      <td>[proquest, denotes, formula, non, ascii, text,...</td>\n",
       "      <td>4. Withdrawal from Paris Agreement</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>2682827386</td>\n",
       "      <td>2022-07-01</td>\n",
       "      <td>2022</td>\n",
       "      <td>7 ag stories you might have missed</td>\n",
       "      <td>Did you miss some agricultural news this week?...</td>\n",
       "      <td>[miss, agricultural, news, week, follow, along...</td>\n",
       "      <td>5. Inflation Reduction Act</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9975</th>\n",
       "      <td>216838183</td>\n",
       "      <td>2003-05-01</td>\n",
       "      <td>2003</td>\n",
       "      <td>The implementation and effectiveness of geogra...</td>\n",
       "      <td>ABSTRACTGeographic information systems (GlS) t...</td>\n",
       "      <td>[abstractgeographic, information, system, gls,...</td>\n",
       "      <td>1. Before Federal Energy Policy</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9976</th>\n",
       "      <td>2848224516</td>\n",
       "      <td>2023-08-11</td>\n",
       "      <td>2023</td>\n",
       "      <td>OPPT'S KEEHNER ANNOUNCES RETIREMENT AMID TSCA ...</td>\n",
       "      <td>Posted August 8, 2023EPA Office of Pollution P...</td>\n",
       "      <td>[post, august, epa, office, pollution, prevent...</td>\n",
       "      <td>5. Inflation Reduction Act</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9982</th>\n",
       "      <td>223683179</td>\n",
       "      <td>2001-05-01</td>\n",
       "      <td>2001</td>\n",
       "      <td>Why do Australian scientists stay overseas?</td>\n",
       "      <td>Since Peter Doherty shared the Nobel Prize for...</td>\n",
       "      <td>[since, peter, doherty, share, nobel, prize, p...</td>\n",
       "      <td>1. Before Federal Energy Policy</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9990</th>\n",
       "      <td>1973343751</td>\n",
       "      <td>2017-12-01</td>\n",
       "      <td>2017</td>\n",
       "      <td>Understanding Fatigue: Implications for Worker...</td>\n",
       "      <td>Workplace safety requires a systematic approac...</td>\n",
       "      <td>[workplace, safety, require, systematic, appro...</td>\n",
       "      <td>4. Withdrawal from Paris Agreement</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9999</th>\n",
       "      <td>2130417268</td>\n",
       "      <td>2018-11-07</td>\n",
       "      <td>2018</td>\n",
       "      <td>Application To Export Electric Energy; Powerex...</td>\n",
       "      <td>Regulatory Documents Agency: \"Office of Electr...</td>\n",
       "      <td>[regulatory, document, agency, office, electri...</td>\n",
       "      <td>4. Withdrawal from Paris Agreement</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>3618 rows × 7 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "            GOID       Date  Year  \\\n",
       "0     2847381007 2023-08-08  2023   \n",
       "4     2820596472 2008-06-23  2008   \n",
       "7      224899780 2008-08-01  2008   \n",
       "10    1963104817 2017-12-01  2017   \n",
       "15    2682827386 2022-07-01  2022   \n",
       "...          ...        ...   ...   \n",
       "9975   216838183 2003-05-01  2003   \n",
       "9976  2848224516 2023-08-11  2023   \n",
       "9982   223683179 2001-05-01  2001   \n",
       "9990  1973343751 2017-12-01  2017   \n",
       "9999  2130417268 2018-11-07  2018   \n",
       "\n",
       "                                                  Title  \\\n",
       "0     Trade Group Threatens Suit Over EPA's Large In...   \n",
       "4                                   Listening to Storms   \n",
       "7                                        URBAN DRILLING   \n",
       "10    Association of eating out with bone density in...   \n",
       "15                   7 ag stories you might have missed   \n",
       "...                                                 ...   \n",
       "9975  The implementation and effectiveness of geogra...   \n",
       "9976  OPPT'S KEEHNER ANNOUNCES RETIREMENT AMID TSCA ...   \n",
       "9982        Why do Australian scientists stay overseas?   \n",
       "9990  Understanding Fatigue: Implications for Worker...   \n",
       "9999  Application To Export Electric Energy; Powerex...   \n",
       "\n",
       "                                                   Text  \\\n",
       "0     August 7, 2023 As EPA weighs options to toughe...   \n",
       "4     A half-mile below the ocean’s surface, where g...   \n",
       "7     Drilling for gas right next to a major univers...   \n",
       "10    (ProQuest: ... denotes formulae and/or non-US-...   \n",
       "15    Did you miss some agricultural news this week?...   \n",
       "...                                                 ...   \n",
       "9975  ABSTRACTGeographic information systems (GlS) t...   \n",
       "9976  Posted August 8, 2023EPA Office of Pollution P...   \n",
       "9982  Since Peter Doherty shared the Nobel Prize for...   \n",
       "9990  Workplace safety requires a systematic approac...   \n",
       "9999  Regulatory Documents Agency: \"Office of Electr...   \n",
       "\n",
       "                                       Processed_Tokens  \\\n",
       "0     [august, epa, weighs, option, toughen, air, to...   \n",
       "4     [half, mile, ocean, surface, giant, squid, spe...   \n",
       "7     [drilling, gas, right, next, major, university...   \n",
       "10    [proquest, denotes, formula, non, ascii, text,...   \n",
       "15    [miss, agricultural, news, week, follow, along...   \n",
       "...                                                 ...   \n",
       "9975  [abstractgeographic, information, system, gls,...   \n",
       "9976  [post, august, epa, office, pollution, prevent...   \n",
       "9982  [since, peter, doherty, share, nobel, prize, p...   \n",
       "9990  [workplace, safety, require, systematic, appro...   \n",
       "9999  [regulatory, document, agency, office, electri...   \n",
       "\n",
       "                                            Time_Period  \n",
       "0                            5. Inflation Reduction Act  \n",
       "4     2. Energy Policy Act of 2005 & Energy Security...  \n",
       "7     2. Energy Policy Act of 2005 & Energy Security...  \n",
       "10                   4. Withdrawal from Paris Agreement  \n",
       "15                           5. Inflation Reduction Act  \n",
       "...                                                 ...  \n",
       "9975                    1. Before Federal Energy Policy  \n",
       "9976                         5. Inflation Reduction Act  \n",
       "9982                    1. Before Federal Energy Policy  \n",
       "9990                 4. Withdrawal from Paris Agreement  \n",
       "9999                 4. Withdrawal from Paris Agreement  \n",
       "\n",
       "[3618 rows x 7 columns]"
      ]
     },
     "execution_count": 21,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.dropna(inplace=True)\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 22,
   "id": "470fc7d2",
   "metadata": {},
   "outputs": [],
   "source": [
    "grouped = df.groupby('Time_Period')\n",
    "for period, group in grouped:\n",
    "    tokens = group['Processed_Tokens'].tolist()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 23,
   "id": "93bd0108",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Running topic modeling for Time Period: 1. Before Federal Energy Policy\n",
      "Training model for 1. Before Federal Energy Policy...\n",
      "Iteration: 0, Log-likelihood: -10.449025395421797\n",
      "Iteration: 10, Log-likelihood: -9.342990053696319\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/tmp/ipykernel_19877/1002871564.py:29: RuntimeWarning: The training result may differ even with fixed seed if `workers` != 1.\n",
      "  mdl.train(1)\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Iteration: 20, Log-likelihood: -9.112102524889234\n",
      "Iteration: 30, Log-likelihood: -9.034435716749059\n",
      "Iteration: 40, Log-likelihood: -8.994942034955404\n",
      "Iteration: 50, Log-likelihood: -8.975299247271703\n",
      "Iteration: 60, Log-likelihood: -8.956299068235875\n",
      "Iteration: 70, Log-likelihood: -8.94311850146176\n",
      "Iteration: 80, Log-likelihood: -8.93287805470332\n",
      "Iteration: 90, Log-likelihood: -8.926726907175468\n",
      "Top words for each topic in 1. Before Federal Energy Policy:\n",
      "Topic #1:  system, water, control, test, state, process, require, material, site, environmental\n",
      "Topic #2:  university, city, water, land, community, college, state, plant, area, fire\n",
      "Topic #3:  study, data, wood, high, increase, result, weight, value, fig, show\n",
      "Topic #4:  company, price, energy, percent, gas, market, product, million, cost, high\n",
      "Topic #5:  work, health, food, program, people, restaurant, time, safety, take, need\n",
      "Running topic modeling for Time Period: 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007\n",
      "Training model for 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007...\n",
      "Iteration: 0, Log-likelihood: -10.582943383922018\n",
      "Iteration: 10, Log-likelihood: -9.3023058138007\n",
      "Iteration: 20, Log-likelihood: -9.110989341963709\n",
      "Iteration: 30, Log-likelihood: -9.043689518544195\n",
      "Iteration: 40, Log-likelihood: -9.000890124340303\n",
      "Iteration: 50, Log-likelihood: -8.975626552454978\n",
      "Iteration: 60, Log-likelihood: -8.961245315365597\n",
      "Iteration: 70, Log-likelihood: -8.947833556305973\n",
      "Iteration: 80, Log-likelihood: -8.93578507719768\n",
      "Iteration: 90, Log-likelihood: -8.92642033430561\n",
      "Top words for each topic in 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007:\n",
      "Topic #1:  cell, figure, neuron, muscle, mouse, response, cluster, model, fire, nucleus\n",
      "Topic #2:  cell, protein, gene, specie, expression, analysis, figure, sample, wrn, human\n",
      "Topic #3:  water, high, study, model, data, low, population, sample, system, time\n",
      "Topic #4:  state, health, work, program, food, need, provide, management, community, research\n",
      "Topic #5:  company, well, product, gas, market, million, energy, oil, cost, price\n",
      "Running topic modeling for Time Period: 3. American Recovery and Reinvestment Act of 2009\n",
      "Training model for 3. American Recovery and Reinvestment Act of 2009...\n",
      "Iteration: 0, Log-likelihood: -10.67336993365925\n",
      "Iteration: 10, Log-likelihood: -9.371223978597563\n",
      "Iteration: 20, Log-likelihood: -9.154754843549911\n",
      "Iteration: 30, Log-likelihood: -9.078625426807177\n",
      "Iteration: 40, Log-likelihood: -9.034537749316847\n",
      "Iteration: 50, Log-likelihood: -9.00560727226227\n",
      "Iteration: 60, Log-likelihood: -8.989310115387987\n",
      "Iteration: 70, Log-likelihood: -8.977264905753765\n",
      "Iteration: 80, Log-likelihood: -8.968557967538505\n",
      "Iteration: 90, Log-likelihood: -8.96212565394213\n",
      "Top words for each topic in 3. American Recovery and Reinvestment Act of 2009:\n",
      "Topic #1:  water, model, data, specie, distribution, analysis, study, sample, source, fig\n",
      "Topic #2:  state, company, research, system, industry, need, technology, project, energy, percent\n",
      "Topic #3:  study, health, age, child, patient, state, subject, court, group, report\n",
      "Topic #4:  eat, first, oil, day, price, time, compound, plant, million, like\n",
      "Topic #5:  cell, gene, protein, figure, sequence, mouse, expression, dna, human, cancer\n",
      "Running topic modeling for Time Period: 4. Withdrawal from Paris Agreement\n",
      "Training model for 4. Withdrawal from Paris Agreement...\n",
      "Iteration: 0, Log-likelihood: -10.590657278860927\n",
      "Iteration: 10, Log-likelihood: -9.460398490477598\n",
      "Iteration: 20, Log-likelihood: -9.1985628377364\n",
      "Iteration: 30, Log-likelihood: -9.109390163417029\n",
      "Iteration: 40, Log-likelihood: -9.063615693740823\n",
      "Iteration: 50, Log-likelihood: -9.03279904799064\n",
      "Iteration: 60, Log-likelihood: -9.0094165528468\n",
      "Iteration: 70, Log-likelihood: -8.993060705273615\n",
      "Iteration: 80, Log-likelihood: -8.979885536667503\n",
      "Iteration: 90, Log-likelihood: -8.970633252177459\n",
      "Top words for each topic in 4. Withdrawal from Paris Agreement:\n",
      "Topic #1:  state, epa, information, program, public, agency, issue, federal, comment, project\n",
      "Topic #2:  health, study, patient, risk, age, data, analysis, among, child, group\n",
      "Topic #3:  gas, production, energy, product, high, plant, increase, per, climate, price\n",
      "Topic #4:  cell, fig, protein, gene, show, journal, expression, treatment, level, day\n",
      "Topic #5:  model, specie, fig, data, omit, water, area, study, high, result\n",
      "Running topic modeling for Time Period: 5. Inflation Reduction Act\n",
      "Training model for 5. Inflation Reduction Act...\n",
      "Iteration: 0, Log-likelihood: -10.62888208650799\n",
      "Iteration: 10, Log-likelihood: -9.511055436208201\n",
      "Iteration: 20, Log-likelihood: -9.245873502796064\n",
      "Iteration: 30, Log-likelihood: -9.172071977687963\n",
      "Iteration: 40, Log-likelihood: -9.13188134750014\n",
      "Iteration: 50, Log-likelihood: -9.104157466981446\n",
      "Iteration: 60, Log-likelihood: -9.08609464410202\n",
      "Iteration: 70, Log-likelihood: -9.068872022672245\n",
      "Iteration: 80, Log-likelihood: -9.058329100514705\n",
      "Iteration: 90, Log-likelihood: -9.046567057957974\n",
      "Top words for each topic in 5. Inflation Reduction Act:\n",
      "Topic #1:  cell, plant, figure, gene, protein, study, analysis, sample, effect, show\n",
      "Topic #2:  health, study, patient, data, test, age, among, analysis, group, risk\n",
      "Topic #3:  epa, information, comment, number, concentration, content, chemical, water, standard, air\n",
      "Topic #4:  state, increase, high, price, production, crop, program, market, plant, project\n",
      "Topic #5:  model, data, figure, study, soil, area, specie, high, show, table\n"
     ]
    }
   ],
   "source": [
    "import tomotopy as tp\n",
    "\n",
    "# Grouping the data by Time_Period\n",
    "grouped = df.groupby('Time_Period')\n",
    "\n",
    "# Define number of topics for modeling\n",
    "NUM_TOPICS = 5\n",
    "\n",
    "# Store topic modeling results\n",
    "topic_models = {}\n",
    "\n",
    "# Loop through each group and run topic modeling\n",
    "for period, group in grouped:\n",
    "    print(f\"Running topic modeling for Time Period: {period}\")\n",
    "    \n",
    "    # Combine tokens into documents for Tomotopy\n",
    "    documents = [' '.join(tokens) for tokens in group['Processed_Tokens']]\n",
    "    \n",
    "    # Initialize a Tomotopy LDA Model\n",
    "    mdl = tp.LDAModel(k=NUM_TOPICS, seed=42)  # k is the number of topics\n",
    "    \n",
    "    # Add documents to the model\n",
    "    for doc in documents:\n",
    "        mdl.add_doc(doc.split())\n",
    "    \n",
    "    # Train the model\n",
    "    print(f\"Training model for {period}...\")\n",
    "    for i in range(100):  # Adjust the number of iterations as needed\n",
    "        mdl.train(1)\n",
    "        if i % 10 == 0:  # Print progress every 10 iterations\n",
    "            print(f\"Iteration: {i}, Log-likelihood: {mdl.ll_per_word}\")\n",
    "    \n",
    "    # Save the trained model to the dictionary\n",
    "    topic_models[period] = mdl\n",
    "\n",
    "    # Print the top words for each topic\n",
    "    print(f\"Top words for each topic in {period}:\")\n",
    "    for topic_id in range(NUM_TOPICS):\n",
    "        topic_words = [word for word, _ in mdl.get_topic_words(topic_id, top_n=10)]\n",
    "        print(f\"Topic #{topic_id + 1}: \", ', '.join(topic_words))\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "04512e30",
   "metadata": {},
   "outputs": [],
   "source": [
    "from sklearn.feature_extraction.text import TfidfVectorizer\n",
    "\n",
    "def compute_tfidf(top_n, grouped):\n",
    "    \"\"\"\n",
    "    Computes the top N words by TF-IDF score for each time period.\n",
    "\n",
    "    Parameters:\n",
    "        top_n (int): Number of top words to extract.\n",
    "        grouped_data (GroupBy): Pandas DataFrame grouped by time period.\n",
    "\n",
    "    Returns:\n",
    "        tfidf_results (dict): Dictionary of time periods -> Top words with TF-IDF scores.\n",
    "    \"\"\"\n",
    "    tfidf_results = {}\n",
    "\n",
    "    # Loop through each group (time period)\n",
    "    for period, group in grouped:\n",
    "        print(f\"Running TF-IDF for Time Period: {period}...\")\n",
    "\n",
    "        # Extract and flatten tokens into a single document\n",
    "        tokens = group['Processed_Tokens'].tolist()  # List of lists\n",
    "        flattened_tokens = [' '.join(tokens_list) for tokens_list in tokens]  # Flatten and join words\n",
    "        \n",
    "        # Combine into one document for TF-IDF\n",
    "        corpus = [' '.join(flattened_tokens)]\n",
    "\n",
    "        # Initialize TF-IDF vectorizer and calculate TF-IDF scores\n",
    "        vectorizer = TfidfVectorizer()\n",
    "        tfidf_matrix = vectorizer.fit_transform(corpus)\n",
    "\n",
    "        # Get feature names and scores\n",
    "        feature_names = vectorizer.get_feature_names_out()\n",
    "        scores = tfidf_matrix.toarray()[0]\n",
    "\n",
    "        # Pair words with their scores and sort\n",
    "        word_scores = sorted(zip(feature_names, scores), key=lambda x: x[1], reverse=True)\n",
    "\n",
    "        # Store the top N words for the current period\n",
    "        tfidf_results[period] = word_scores[:top_n]\n",
    "\n",
    "    return tfidf_results"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "5ddf24b9",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Running TF-IDF for Time Period: 1. Before Federal Energy Policy...\n",
      "Running TF-IDF for Time Period: 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007...\n",
      "Running TF-IDF for Time Period: 3. American Recovery and Reinvestment Act of 2009...\n",
      "Running TF-IDF for Time Period: 4. Withdrawal from Paris Agreement...\n",
      "Running TF-IDF for Time Period: 5. Inflation Reduction Act...\n",
      "\n",
      "Top 10 words for Time Period '1. Before Federal Energy Policy':\n",
      "high: 0.1337\n",
      "time: 0.1323\n",
      "state: 0.1310\n",
      "increase: 0.1209\n",
      "system: 0.1179\n",
      "company: 0.1165\n",
      "water: 0.1133\n",
      "work: 0.1085\n",
      "well: 0.1041\n",
      "health: 0.0980\n",
      "\n",
      "Top 10 words for Time Period '2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007':\n",
      "cell: 0.1724\n",
      "water: 0.1393\n",
      "state: 0.1365\n",
      "high: 0.1283\n",
      "time: 0.1224\n",
      "study: 0.1176\n",
      "well: 0.1158\n",
      "system: 0.1093\n",
      "increase: 0.1019\n",
      "two: 0.0992\n",
      "\n",
      "Top 10 words for Time Period '3. American Recovery and Reinvestment Act of 2009':\n",
      "study: 0.1539\n",
      "state: 0.1430\n",
      "cell: 0.1345\n",
      "high: 0.1213\n",
      "gene: 0.1190\n",
      "water: 0.1158\n",
      "time: 0.1143\n",
      "figure: 0.1128\n",
      "analysis: 0.1120\n",
      "data: 0.1111\n",
      "\n",
      "Top 10 words for Time Period '4. Withdrawal from Paris Agreement':\n",
      "study: 0.1908\n",
      "data: 0.1472\n",
      "state: 0.1456\n",
      "high: 0.1388\n",
      "model: 0.1339\n",
      "health: 0.1218\n",
      "cell: 0.1207\n",
      "time: 0.1148\n",
      "analysis: 0.1147\n",
      "increase: 0.1127\n",
      "\n",
      "Top 10 words for Time Period '5. Inflation Reduction Act':\n",
      "study: 0.2108\n",
      "high: 0.1796\n",
      "data: 0.1535\n",
      "figure: 0.1419\n",
      "model: 0.1405\n",
      "increase: 0.1350\n",
      "analysis: 0.1326\n",
      "result: 0.1216\n",
      "sample: 0.1215\n",
      "show: 0.1137\n"
     ]
    }
   ],
   "source": [
    "# Group tokens by 'Time_Period'\n",
    "grouped_new = df.groupby('Time_Period')\n",
    "\n",
    "# Compute TF-IDF for the top 10 words\n",
    "top_n = 10\n",
    "tfidf_results = compute_tfidf(top_n, grouped)\n",
    "\n",
    "# Print TF-IDF results\n",
    "for period, words in tfidf_results.items():\n",
    "    print(f\"\\nTop {top_n} words for Time Period '{period}':\")\n",
    "    for word, score in words:\n",
    "        print(f\"{word}: {score:.4f}\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "fb865677",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Generating PyLDAvis for Time Period: 1. Before Federal Energy Policy...\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n",
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/site-packages/joblib/externals/loky/backend/fork_exec.py:38: DeprecationWarning: This process (pid=19877) is multi-threaded, use of fork() may lead to deadlocks in the child.\n",
      "  pid = os.fork()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "PyLDAvis visualization for 1. Before Federal Energy Policy:\n",
      "Saved PyLDAvis visualization for 1. Before Federal Energy Policy to pyldavis_1._Before_Federal_Energy_Policy.html\n",
      "\n",
      "Generating PyLDAvis for Time Period: 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007...\n",
      "PyLDAvis visualization for 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007:\n",
      "Saved PyLDAvis visualization for 2. Energy Policy Act of 2005 & Energy Security and Independence Act of 2007 to pyldavis_2._Energy_Policy_Act_of_2005_&_Energy_Security_and_Independence_Act_of_2007.html\n",
      "\n",
      "Generating PyLDAvis for Time Period: 3. American Recovery and Reinvestment Act of 2009...\n",
      "PyLDAvis visualization for 3. American Recovery and Reinvestment Act of 2009:\n",
      "Saved PyLDAvis visualization for 3. American Recovery and Reinvestment Act of 2009 to pyldavis_3._American_Recovery_and_Reinvestment_Act_of_2009.html\n",
      "\n",
      "Generating PyLDAvis for Time Period: 4. Withdrawal from Paris Agreement...\n",
      "PyLDAvis visualization for 4. Withdrawal from Paris Agreement:\n",
      "Saved PyLDAvis visualization for 4. Withdrawal from Paris Agreement to pyldavis_4._Withdrawal_from_Paris_Agreement.html\n",
      "\n",
      "Generating PyLDAvis for Time Period: 5. Inflation Reduction Act...\n",
      "PyLDAvis visualization for 5. Inflation Reduction Act:\n",
      "Saved PyLDAvis visualization for 5. Inflation Reduction Act to pyldavis_5._Inflation_Reduction_Act.html\n",
      "\n"
     ]
    }
   ],
   "source": [
    "import pyLDAvis\n",
    "import pyLDAvis.gensim_models as gensimvis\n",
    "from gensim import corpora, models\n",
    "\n",
    "\n",
    "def generate_pyldavis_visualizations(grouped_data, num_topics=5):\n",
    "    \"\"\"\n",
    "    Generate and display PyLDAvis visualizations for each time period.\n",
    "\n",
    "    Parameters:\n",
    "        grouped_data (GroupBy): Grouped DataFrame by 'Time_Period'.\n",
    "        num_topics (int): Number of topics for the LDA model.\n",
    "    \"\"\"\n",
    "    for period, group in grouped:\n",
    "        print(f\"Generating PyLDAvis for Time Period: {period}...\")\n",
    "\n",
    "        # Prepare tokens for the time period\n",
    "        tokens = group['Processed_Tokens'].tolist()  # List of lists of tokens\n",
    "        \n",
    "        # Create a Gensim dictionary and corpus\n",
    "        dictionary = corpora.Dictionary(tokens)\n",
    "        corpus = [dictionary.doc2bow(text) for text in tokens]\n",
    "\n",
    "        lda_model = models.LdaModel(corpus=corpus, id2word=dictionary, num_topics=num_topics, random_state=42)\n",
    "\n",
    "        # Prepare PyLDAvis visualization\n",
    "        vis = gensimvis.prepare(lda_model, corpus, dictionary)\n",
    "\n",
    "        # Display PyLDAvis in Jupyter Notebook\n",
    "        print(f\"PyLDAvis visualization for {period}:\")\n",
    "        pyLDAvis.display(vis)\n",
    "\n",
    "        output_file = f\"pyldavis_{period.replace(' ', '_')}.html\"\n",
    "        pyLDAvis.save_html(vis, output_file)\n",
    "        print(f\"Saved PyLDAvis visualization for {period} to {output_file}\\n\")\n",
    "\n",
    "# Group data by 'Time_Period'\n",
    "grouped = df.groupby('Time_Period')\n",
    "\n",
    "# Generate PyLDAvis visualizations\n",
    "generate_pyldavis_visualizations(grouped, num_topics=5)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 46,
   "id": "a8417591",
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_export = '/home/ec2-user/SageMaker/pyldavis_1._Before_Federal_Energy_Policy.html'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 47,
   "id": "45e4f184",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/pty.py:95: DeprecationWarning: This process (pid=19877) is multi-threaded, use of forkpty() may lead to deadlocks in the child.\n",
      "  pid, fd = os.forkpty()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Completed 80.3 KiB/80.3 KiB (648.1 KiB/s) with 1 file(s) remaining\r",
      "upload: ./pyldavis_1._Before_Federal_Energy_Policy.html to s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/pyldavis_1._Before_Federal_Energy_Policy.html\r\n"
     ]
    }
   ],
   "source": [
    "!aws s3 cp $data_to_export s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "id": "e79667fc",
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_export = '/home/ec2-user/SageMaker/pyldavis_2._Energy_Policy_Act_of_2005_&_Energy_Security_and_Independence_Act_of_2007.html'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 59,
   "id": "b95fb9d6",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "/bin/bash: _Energy_Security_and_Independence_Act_of_2007.html: command not found\r\n"
     ]
    },
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/pty.py:95: DeprecationWarning: This process (pid=19877) is multi-threaded, use of forkpty() may lead to deadlocks in the child.\n",
      "  pid, fd = os.forkpty()\n"
     ]
    }
   ],
   "source": [
    "!aws s3 cp $data_to_export s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 50,
   "id": "682f09ba",
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_export = '/home/ec2-user/SageMaker/pyldavis_3._American_Recovery_and_Reinvestment_Act_of_2009.html'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 51,
   "id": "7181f714",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/pty.py:95: DeprecationWarning: This process (pid=19877) is multi-threaded, use of forkpty() may lead to deadlocks in the child.\n",
      "  pid, fd = os.forkpty()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Completed 82.1 KiB/82.1 KiB (1.0 MiB/s) with 1 file(s) remaining\r",
      "upload: ./pyldavis_3._American_Recovery_and_Reinvestment_Act_of_2009.html to s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/pyldavis_3._American_Recovery_and_Reinvestment_Act_of_2009.html\r\n"
     ]
    }
   ],
   "source": [
    "!aws s3 cp $data_to_export s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 52,
   "id": "c3c31c03",
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_export = '/home/ec2-user/SageMaker/pyldavis_4._Withdrawal_from_Paris_Agreement.html'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 53,
   "id": "255efdf4",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/pty.py:95: DeprecationWarning: This process (pid=19877) is multi-threaded, use of forkpty() may lead to deadlocks in the child.\n",
      "  pid, fd = os.forkpty()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Completed 85.4 KiB/85.4 KiB (1.1 MiB/s) with 1 file(s) remaining\r",
      "upload: ./pyldavis_4._Withdrawal_from_Paris_Agreement.html to s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/pyldavis_4._Withdrawal_from_Paris_Agreement.html\r\n"
     ]
    }
   ],
   "source": [
    "!aws s3 cp $data_to_export s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 54,
   "id": "dacdb026",
   "metadata": {},
   "outputs": [],
   "source": [
    "data_to_export = '/home/ec2-user/SageMaker/pyldavis_5._Inflation_Reduction_Act.html'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 55,
   "id": "03b5dfce",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "/home/ec2-user/SageMaker/.conda/envs/my_py/lib/python3.12/pty.py:95: DeprecationWarning: This process (pid=19877) is multi-threaded, use of forkpty() may lead to deadlocks in the child.\n",
      "  pid, fd = os.forkpty()\n"
     ]
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Completed 84.1 KiB/84.1 KiB (363.2 KiB/s) with 1 file(s) remaining\r",
      "upload: ./pyldavis_5._Inflation_Reduction_Act.html to s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/pyldavis_5._Inflation_Reduction_Act.html\r\n"
     ]
    }
   ],
   "source": [
    "!aws s3 cp $data_to_export s3://pq-tdm-studio-results/tdm-ale-data/a2252/results/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f9a7943e",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "conda_my_py",
   "language": "python",
   "name": "conda_my_py"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.12.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
